---
- name: Core Router Configuration
  hosts: core_routers
  gather_facts: no
  connection: local

  tasks:

  - name: Set Hostname
    ios_config:
      provider: "{{ provider }}"  # Read from group_vars/all.yml
      lines: hostname "{{ inventory_hostname }}"

  - name: Configure Interface
    ios_config:
      provider: "{{ provider }}"
      lines:
      - description: "{{ item.desc }}"
      - ip_add: "{{ item.ip }} {{item.mask}}"
      parents: interface {{ item.key }}
    with_items: "{{ loopback }}" # Should be read from group_vars/router.yml
    tags: loopback
    
    #  handlers:
#    - name: save-ios
#      ios_command:
#        commands: "write memory"
#        timeout: 40
#      when: not ansible_check_mode
